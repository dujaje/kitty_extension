<!-- Uer Page Title -->
<% @title = "#{@user.first_name}'s Dashboard" %>

<!-- Fixed Navigation Button -->
<!-- Title in the navbar is always determined in the controller. -->
<%= render 'shared/fixed_nav_btn' %>
<!-- Navbar -->
<%= render 'shared/navbar_with_menu' %>
<!-- Tabs Bar -->
<div class="tab">
  <button class="tablinks" id="firsttab" onclick="openCity(event, 'FirstTab')"><%= @tabs[0] %></button>
  <% @tabs.each_with_index do |tab, index| %>
    <% if index != 0 %>
    <button class="tablinks" onclick="openCity(event, '<%= tab %>')"><%= tab %></button>
    <% end %>
  <% end %>
</div>

<!-- Groups Body -->
<div id="FirstTab" class="tabcontent">
  <div class="container">
    <div class="title-section">
      <h2>Your Groups</h2>
    </div>

    <% @user.groups.each do |group| %>
      <%= link_to group_path(user_id: @user.id, group_id: group.id) do %>
        <% if group.memberships.length == 1 %>
          <!-- Group Card With Only One Member -->
          <div class="card">
            <div class="groups-card-img-top group-card-img-size" style="background-image: url(<%=group.users.first.profile_picture_url%>);"></div>
            <div class="card-body">
              <h4 class="card-title"><%= group.name.capitalize %></h4>
              <% if @user.outstanding_with_group(group) == 0 %>
                <p>All square in this group!</p>
              <% elsif @user.outstanding_with_group(group) > 0 %>
                <p>Overall, the group owes you: <span class="color-primary">£<%= sprintf("%.2f", @user.outstanding_with_group(group)).to_f / 100 %></span></p>
              <% else %>
                <p>Overall, you owe this group: <span class="color-warning">£<%= sprintf("%.2f", @user.outstanding_with_group(group)).to_f * -1 / 100 %></span></p>
              <% end %>
              <%= link_to group_path(user_id: @user.id, group_id: group.id) do %>
                <p class="btn btn-filled-primary no-margin"><i class="fa fa-search fa-fw" aria-hidden="true"></i> See Group</p>
              <% end %>
            </div>
          </div>
          <div class="card-row-space"></div>
        <% elsif group.memberships.length == 2 %>
          <!-- Group with 2 Members -->
          <div class="card">
            <div class="groups-card-img-top group-card-img-size group-card-members-grid-2" style="background-image: url(https://placeholdit.co//i/550x350);">
              <div class="group-card-members-grid-2-child" style="background-image: url(<%=group.users.first.profile_picture_url%>);"></div>
              <div class="group-card-members-grid-2-child" style="background-image: url(<%=group.users.last.profile_picture_url%>);"></div>
            </div>
            <div class="card-body">
              <h4 class="card-title"><%= group.name.capitalize %></h4>
              <% if @user.outstanding_with_group(group) == 0 %>
                <p>All square in this group!</p>
              <% elsif @user.outstanding_with_group(group) > 0 %>
                <p>Overall, the group owes you: <span class="color-primary">£<%= sprintf("%.2f", @user.outstanding_with_group(group)).to_f / 100 %></span></p>
              <% else %>
                <p>Overall, you owe this group: <span class="color-warning">£<%= sprintf("%.2f", @user.outstanding_with_group(group)).to_f * -1 / 100 %></span></p>
              <% end %>
              <%= link_to group_path(user_id: @user.id, group_id: group.id) do %>
                <p class="btn btn-filled-primary no-margin"><i class="fa fa-search fa-fw" aria-hidden="true"></i> See Group</p>
              <% end %>
            </div>
          </div>
          <div class="card-row-space"></div>
        <% elsif group.memberships.length == 3 %>
          <!-- Group with 3 Members -->
          <div class="card">
            <div class="groups-card-img-top group-card-img-size group-card-members-grid-over2" style="background-image: url(https://placeholdit.co//i/550x350);">
              <div class="group-card-members-grid-3-child-a" style="background-image: url(<%=group.users.first.profile_picture_url%>);"></div>
              <div class="group-card-members-grid-3-child-b" style="background-image: url(<%=group.users[1].profile_picture_url%>);"></div>
              <div class="group-card-members-grid-3-child-c" style="background-image: url(<%=group.users.last.profile_picture_url%>);"></div>
            </div>
            <div class="card-body">
              <h4 class="card-title"><%= group.name.capitalize %></h4>
              <% if @user.outstanding_with_group(group) == 0 %>
                <p>All square in this group!</p>
              <% elsif @user.outstanding_with_group(group) > 0 %>
                <p>Overall, the group owes you: <span class="color-primary">£<%= sprintf("%.2f", @user.outstanding_with_group(group)).to_f / 100 %></span></p>
              <% else %>
                <p>Overall, you owe this group: <span class="color-warning">£<%= sprintf("%.2f", @user.outstanding_with_group(group)).to_f * -1 / 100 %></span></p>
              <% end %>
              <%= link_to group_path(user_id: @user.id, group_id: group.id) do %>
                <p class="btn btn-filled-primary no-margin"><i class="fa fa-search fa-fw" aria-hidden="true"></i> See Group</p>
              <% end %>
            </div>
          </div>
          <div class="card-row-space"></div>
        <% else %>
          <!-- Group with 4+ Members -->
          <div class="card">
            <div class="groups-card-img-top group-card-img-size group-card-members-grid-over2" style="background-image: url(https://placeholdit.co//i/550x350);">
              <div class="group-card-members-grid-4-child-a" style="background-image: url(<%=group.users[0].profile_picture_url%>);"></div>
              <div class="group-card-members-grid-4-child-b" style="background-image: url(<%=group.users[1].profile_picture_url%>);"></div>
              <div class="group-card-members-grid-4-child-c" style="background-image: url(<%=group.users[2].profile_picture_url%>);"></div>
              <div class="group-card-members-grid-4-child-d" style="background-image: url(<%=group.users[3].profile_picture_url%>);"></div>
            </div>
            <div class="card-body">
              <h4 class="card-title"><%= group.name.capitalize %></h4>
              <% if @user.outstanding_with_group(group) == 0 %>
                <p>All square in this group!</p>
              <% elsif @user.outstanding_with_group(group) > 0 %>
                <p>Overall, the group owes you: <span class="color-primary">£<%= sprintf("%.2f", @user.outstanding_with_group(group)).to_f / 100 %></span></p>
              <% else %>
                <p>Overall, you owe this group: <span class="color-warning">£<%= sprintf("%.2f", @user.outstanding_with_group(group)).to_f * -1 / 100 %></span></p>
              <% end %>
              <%= link_to group_path(user_id: @user.id, group_id: group.id) do %>
                <p class="btn btn-filled-primary no-margin"><i class="fa fa-search fa-fw" aria-hidden="true"></i> See Group</p>
              <% end %>
            </div>
          </div>
          <div class="card-row-space"></div>
        <% end %>

      <% end %>
    <% end %>
  </div>
</div>

<!-- Transactions Body -->
<div id="Transactions" class="tabcontent" style="display: none;">
  <div class="container">
    <div class="title-section">
      <h2>Your Expenses</h2>
    </div>
    <% @transactions.each do %>
    <div class="list-item-tall">
      <div class="divider">
        <div class="list-item-divider-content">
          <p class="list-item-text"><strong>Jamie Dujardin</strong></p>
          <p class="list-item-text" >You're all square</p>
        </div>
        <div class="list-item-arrow-btn .align-baseline">
          <p class="list-item-text" ><i class="fa fa-arrow-right" aria-hidden="true"></i></p>
        </div>
      </div>
    </div>
    <% end %>
  </div>
</div>

<!-- People Body -->
<div id="People" class="tabcontent" style="display: none;">
  <div class="container">

    <% unless @users_user_owed_by.empty? %>
      <div class="title-section">
        <h2>You are owed</h2>
      </div>
      <% @users.each do |member| %>
        <% if member == @user %>
          <% next %>
        <% elsif @user.outstanding_with_person_overall(member) == 0 %>
          <% next %>
        <% elsif @user.outstanding_with_person_overall(member) > 0 %>
          <div class="list-item-tall">
            <div class="profile-img-container">
              <%= image_tag member.profile_picture_url, class: "avatar-medium" %>
            </div>
            <div class="divider">
              <div class="list-item-divider-content">
                <p class="list-item-text"><strong><%= member.first_name %> <%= member.last_name %></strong></p>
                <p class="list-item-text">Owes you: <span class="color-primary">£<%= sprintf("%.2f", @user.outstanding_with_person_overall(member).to_f / 100) %></span></p>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    <% end %>

    <% unless @users_user_owes.empty? %>
      <div class="title-section">
        <h2>You owe</h2>
      </div>
      <% @users.each do |member| %>
        <% if member == @user %>
          <% next %>
        <% elsif @user.outstanding_with_person_overall(member) == 0 %>
          <% next %>
        <% elsif @user.outstanding_with_person_overall(member) < 0 %>
          <div class="list-item-tall">
            <div class="profile-img-container">
              <%= image_tag member.profile_picture_url, class: "avatar-medium" %>
            </div>
            <div class="divider">
              <div class="list-item-divider-content">
                <p class="list-item-text"><strong><%= member.first_name %> <%= member.last_name %></strong></p>
                <p class="list-item-text" >You owe: <span class="color-warning"> £<%= sprintf("%.2f", @user.outstanding_with_person_overall(member).to_f * -1 / 100) %></span></p>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>
</div>

<!-- Javascript that controls tabs activation -->
<script>
  // TABS SELECTOR
  const firstTab = document.getElementById("FirstTab");
  firstTab.style.display = "block";
  const firsttab = document.getElementById("firsttab")
  firsttab.className += " active";
  function openCity(evt, cityName) {
    var i, tabcontent, tablinks;
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }
    document.getElementById(cityName).style.display = "block";
    evt.currentTarget.className += " active";
  }
</script>
